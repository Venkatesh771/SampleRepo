<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="Assests/Icon.png" type="image/x-icon">
  <title>Appointment</title>
  <!-- Bootstrap CSS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: "Nunito Sans", sans-serif;
    }

    .appo-page {
      margin: 50px auto;
      max-width: 1200px;
    }

    .left img {
      max-width: 100%;
      height: auto;
    }

    .card {
      backdrop-filter: blur(15px);
    }

    button {
      background-color: #fc1355;
      border: none;
    }

    button:hover {
      background-color: #e5124b;
    }
  </style>
</head>

<body>
    <div class="container appo-page mt-5">
        <div class="row justify-content-center">
          <!-- Appointment Form -->
          <div class="col-md-8 col-lg-6">
            <div class="card shadow-lg border-0">
              <div class="card-header bg-primary text-white text-center">
                <h4 class="mb-0">Book Appointment</h4>
              </div>
              <div class="card-body p-4 bg-light">
                <form name="submit-to-google-sheet" action="https://api.web3forms.com/submit" method="POST"
                  onsubmit="return validateForm()">
      
                  <input type="hidden" name="access_key" value="55b17a47-ec07-4043-9864-218d84ce5a88">
                  <input type="hidden" name="subject" value="New Appointment..!">
      
                  <div class="form-group">
                    <label for="name">Patient Name:</label>
                    <input type="text" id="name" name="name" class="form-control form-control-sm" required>
                  </div>
      
                  <div class="form-group">
                    <label for="phone">Phone Number:</label>
                    <input type="tel" id="phone" name="phone" class="form-control form-control-sm" required>
                  </div>
      
                  <div class="form-group">
                    <label for="email">E-mail:</label>
                    <input type="email" id="email" name="email" class="form-control form-control-sm" required>
                  </div>
      
                  <div class="form-group">
                    <label for="gender">Gender:</label>
                    <select id="gender" name="gender" class="form-control form-control-sm">
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
      
                  <div class="form-group">
                    <label for="age">Age:</label>
                    <input type="number" id="age" name="age" class="form-control form-control-sm" required>
                  </div>
      
                  <div class="form-group">
                    <label for="appointmentDate">Appointment Date:</label>
                    <input type="date" id="appointmentDate" name="appointmentDate" class="form-control form-control-sm" required>
                  </div>
      
                  <div class="form-group row">
                    <div class="col-8">
                      <label for="appointmentTime">Appointment Time:</label>
                      <input type="time" id="appointmentTime" name="appointmentTime" class="form-control form-control-sm" required>
                    </div>
                    <div class="col-4">
                      <label for="timePeriod">Period:</label>
                      <select id="timePeriod" class="form-control form-control-sm">
                        <option value="AM">AM</option>
                        <option value="PM">PM</option>
                      </select>
                    </div>
                  </div>
      
                  <button type="submit" class="btn btn-primary btn-block">Book Appointment</button>
                </form>
              </div>
              <div class="card-footer text-center text-muted">
                &copy; 2025 Hospital Appointment System
              </div>
            </div>
          </div>
        </div>
      </div>
      

  <!-- Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbz4cK9OR3Vys7TR1yn71y6aGN6iuWENP1GeLpnKHttEZzJSRt4R1V6Z8azKH5RYu0V4/exec';
    const form = document.forms['submit-to-google-sheet'];

    form.addEventListener('submit', e => {
      e.preventDefault();

      const validationErrors = validateForm();
      if (validationErrors.length > 0) {
        alert(validationErrors.join("\n"));
        return;
      }

      fetch(scriptURL, {
        method: 'POST',
        body: new FormData(form)
      })
        .then(response => {
          console.log('Success! Data sent to Google Sheets:', response);
          return fetch(form.action, {
            method: form.method,
            body: new FormData(form)
          });
        })
        .then(response => {
          console.log('Success! Data sent to Web3Forms:', response);
          const successMessage = document.createElement('div');
          successMessage.style.color = 'Black';
          successMessage.style.marginTop = '12px';
          successMessage.style.textAlign = 'center';
          successMessage.textContent = 'Appointment booked successfully!';
          form.appendChild(successMessage);
          setTimeout(() => {
            form.reset();
            form.removeChild(successMessage);
          }, 3000);
        })
        .catch(error => console.error('Error:', error));
    });

    function validateForm() {
      const errors = [];

      var name = document.getElementById("name").value;
      if (!/^(?=.*[a-zA-Z])[a-zA-Z ]{3,}$/.test(name)) {
        errors.push("Invalid Name..! it should be at least 3 to 18 characters and contain only alphabets, but not numbers and special symbols.");
      }

      var phone = document.getElementById("phone").value;
      if (!/^\d{10}$/.test(phone)) {
        errors.push("Invalid Phone Number..! Please enter a 10-digit number without any special characters And Symbols.");
      }

      var email = document.getElementById("email").value;
      if (!/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(email)) {
        errors.push("Invalid Email Address..! Please enter a valid email address.");
      }

      var age = document.getElementById("age").value;
      if (isNaN(age)) {
        errors.push("Invalid Age.! Please enter a valid Age.");
      }

      return errors;
    }

    var currentDate = new Date();
    var currentDateString = currentDate.toISOString().split('T')[0];
    var currentHour = currentDate.getHours();
    var currentMinute = currentDate.getMinutes();
    var amPM = currentHour >= 12 ? 'PM' : 'AM';
    currentHour = currentHour % 12;
    currentHour = currentHour ? currentHour : 12;
    var currentTimeString = currentHour + ":" + (currentMinute < 10 ? '0' : '') + currentMinute;

    document.getElementById("appointmentDate").min = currentDateString;
    document.getElementById("appointmentTime").min = currentTimeString;

    document.getElementById("timePeriod").addEventListener("change", function () {
      var timeInput = document.getElementById("appointmentTime").value;
      var selectedPeriod = this.value;
      if (selectedPeriod === "PM") {
        var hours = parseInt(timeInput.split(":")[0]);
        if (hours < 12) {
          hours += 12;
        }
        timeInput = hours + ":" + timeInput.split(":")[1];
      } else {
        var hours = parseInt(timeInput.split(":")[0]);
        if (hours === 12) {
          hours = 0;
        }
        timeInput = (hours < 10 ? '0' : '') + hours + ":" + timeInput.split(":")[1];
      }
      document.getElementById("appointmentTime").value = timeInput;
    });
  </script>
</body>

</html>
